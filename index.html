<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deprescribing Compass</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to right, #c2e9fb, #a1c4fd);
      color: #333;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #1e3a8a;
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 20px;
    }
    .form-section {
      background: #ffffff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 15px;
    }
    textarea, input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      background-color: #1e3a8a;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 10px;
    }
    button:hover {
      background-color: #3b82f6;
    }
    #output {
      white-space: pre-wrap;
      background-color: #f0fdf4;
      border-left: 5px solid #22c55e;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 1.1rem;
    }
  </style>
  <script>
    function checkDeprescribing() {
      const goals = document.getElementById("goals").value;
      const prognosis = document.getElementById("prognosis").value;
      const medications = document.getElementById("medications").value.toLowerCase().split(",").map(med => med.trim());
      const age = parseInt(document.getElementById("age").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const conditions = document.getElementById("conditions").value.toLowerCase();

      let recommendations = `✨ Deprescribing Recommendations based on:\n- Goals of Care: ${goals}\n- Prognosis: ${prognosis}\n- Age: ${age}\n- Weight: ${weight}kg\n\n`;

      const classData = {
        "benzodiazepine": {
          recommendation: "May be deprescribed due to risks of falls, cognitive impairment, and sedation.",
          severity: "High",
          reference: "AMH, Maudsley",
          link: "https://www.nps.org.au/news/benzodiazepines-the-risks-and-alternatives"
        },
        "ssri": {
          recommendation: "Consider tapering if not providing clear benefit, especially in palliative settings.",
          severity: "Moderate",
          reference: "Maudsley Prescribing Guidelines",
          link: "https://www.nps.org.au/radar/articles/ssris-in-the-elderly"
        },
        "ppi": {
          recommendation: "Taper if no ongoing indication like reflux or ulcer prevention in NSAID users.",
          severity: "Low",
          reference: "Therapeutic Guidelines Gastrointestinal",
          link: "https://www.nps.org.au/news/proton-pump-inhibitors-time-to-review"
        },
        "antipsychotic": {
          recommendation: "Review in dementia and behavioral issues; consider tapering if risks outweigh benefits.",
          severity: "High",
          reference: "Therapeutic Guidelines Psychotropic",
          link: "https://www.nps.org.au/news/antipsychotics-in-dementia"
        },
        "opioid": {
          recommendation: "Taper if not required for acute pain or if function/quality of life not improved.",
          severity: "High",
          reference: "Australian Guidelines for Opioid Deprescribing",
          link: "https://www.nps.org.au/news/deprescribing-opioids-in-chronic-pain"
        },
         "statin": {
          recommendation: "Statins like atorvastatin or simvastatin may be deprescribed in patients with limited life expectancy (<1 year) where primary prevention is no longer beneficial.",
          severity: "Moderate - While statins help in reducing cardiovascular risk, in end-of-life scenarios, the burden may outweigh the benefit. Continuing statins could be decreasing comfort and increasing medication burden for patients with a poor prognosis.",
          reference: "eTG, AMH",
          link: "https://www.etg.org.au/"
        },
        "acetylcholinesterase inhibitor": {
          recommendation: "Drugs like donepezil or rivastigmine may be deprescribed in end-stage dementia when no functional improvement is expected. Gradual taper is advised.",
          severity: "High - These medications may be contributing to adverse effects without meaningful benefit, impacting QOL. Discontinuing these drugs can enhance comfort by reducing confusion, sedation, and other side effects.",
          reference: "MATCH-D, AMH",
          link: "https://www.amh.net.au/"
        },
        "antiplatelet": {
          recommendation: "Agents like aspirin or clopidogrel used for primary prevention may be deprescribed if bleeding risk outweighs benefit.",
          severity: "High - Reduces bleeding risks and may be burdensome if continued in patients with limited prognosis. The continued use of antiplatelets can contribute to a higher bleeding risk, which may significantly impact patient comfort.",
          reference: "eTG, AMH",
          link: "https://www.etg.org.au/"
        },
        "biguanide": {
          recommendation: "Metformin should be reviewed in frail elderly patients, especially if eGFR <30 mL/min or low HbA1c targets.",
          severity: "Moderate - May contribute to lactic acidosis in frail patients with kidney dysfunction, decreasing overall safety. In palliative care, these medications should be reconsidered as they may pose risks without significant benefits.",
          reference: "eTG",
          link: "https://www.etg.org.au/"
          },
        "ccb": {
          recommendation: "Calcium channel blockers like amlodipine may contribute to hypotension or falls in frail patients. Review BP targets.",
          severity: "High - Contributes to hypotension or falls in frail patients, decreasing functional ability and safety. Deprescribing these agents may prevent adverse effects such as falls and dizziness, enhancing overall patient comfort.",
          reference: "eTG",
          link: "https://www.etg.org.au/"
        },
        "insulin": {
          recommendation: "Insulin may be deprescribed or reduced in elderly/frail if HbA1c target is relaxed or risk of hypoglycaemia is high.",
          severity: "Moderate - Reducing insulin or adjusting doses in elderly patients may reduce risks of hypoglycemia and improve QOL. In palliative care, reducing insulin can help prevent unnecessary complications, improving comfort.",
          reference: "eTG, AMH",
          link: "https://www.etg.org.au/"
        },
        "anticoagulant": {
          recommendation: "Agents like warfarin or DOACs may be deprescribed in limited prognosis unless essential (e.g. mechanical valves).",
          severity: "High - May significantly impact QOL due to bleeding risks, especially in patients with limited life expectancy. Deprescribing these agents can reduce the risk of bleeding complications, improving safety and comfort.",
          reference: "AMH",
          link: "https://www.amh.net.au/"
        },
        "bisphosphonate": {
          recommendation: "Bisphosphonates like alendronate may be stopped after 5 years or in patients near end of life with low fracture risk.",
          severity: "Low - May be unnecessary in patients near the end of life, without contributing significantly to QOL. Discontinuing bisphosphonates may reduce medication burden without compromising comfort.",
          reference: "AMH",
          link: "https://www.amh.net.au/"
        }
      };

      const classKeywords = {
        "benzodiazepine": ["diazepam", "temazepam", "oxazepam", "lorazepam"],
        "ssri": ["sertraline", "fluoxetine", "escitalopram", "citalopram"],
        "ppi": ["omeprazole", "esomeprazole", "pantoprazole", "lansoprazole"],
        "antipsychotic": ["risperidone", "olanzapine", "quetiapine", "haloperidol"],
        "opioid": ["codeine", "tramadol", "oxycodone", "morphine"],
        "statin": ["atorvastatin", "simvastatin", "rosuvastatin", "pravastatin"],
        "acetylcholinesterase inhibitor": ["donepezil", "rivastigmine", "galantamine"],
        "antiplatelet": ["aspirin", "clopidogrel", "dipyridamole"],
        "biguanide": ["metformin"],
        "ccb": ["amlodipine", "felodipine", "nifedipine"],
        "insulin": ["insulin glargine", "insulin aspart", "insulin detemir"],
        "anticoagulant": ["warfarin", "apixaban", "rivaroxaban", "dabigatran"],
        "bisphosphonate": ["alendronate", "risedronate", "zoledronic acid"]
      };

      let burdenScore = 0;
      medications.forEach(med => {
        Object.entries(classKeywords).forEach(([drugClass, names]) => {
          if (names.some(name => med.includes(name))) {
            const entry = classData[drugClass];
            let rationale = "";

            if (goals === "Symptom control") {
              rationale = "In symptom control, minimizing adverse effects is key.";
            } else if (goals === "Life extension") {
              rationale = "For life extension, consider risks that may increase mortality.";
            } else if (goals === "Functional improvement") {
              rationale = "Prioritize cognitive and physical function preservation.";
            }

            if (prognosis === "Limited (<1 year)") {
              rationale += " Preventive or long-latency benefit medications often deprescribed.";
            } else if (prognosis === "Good (>5 years)") {
              rationale += " Long-term benefit medications may be continued if tolerated.";
            }

            recommendations += `• ⚖️ ${drugClass.toUpperCase()}: ${entry.recommendation}\nSeverity: ${entry.severity}\n${rationale}\nReference: ${entry.reference}\nLink: ${entry.link}\n\n`;

            if (entry.severity === "High") burdenScore += 2;
            else if (entry.severity === "Moderate") burdenScore += 1;
            else if (entry.severity === "Low") burdenScore += 0.5;
          }
        });
      });

      recommendations += `🧮 Sedative Medication Burden Score: ${burdenScore} (Higher = greater risk of cognitive/motor impairment)\n`;
      if (burdenScore === 0) {
        recommendations += "No high-risk sedating medications detected.\n";
      }

      document.getElementById("output").textContent = recommendations;
    }

    function downloadSummary() {
      const content = document.getElementById("output").textContent;
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = window.URL.createObjectURL(blob);
      link.download = "deprescribing_summary.txt";
      link.click();
    }
  </script>
</head>
<body>
  <h1>Deprescribing Compass - Pharmacist Tool</h1>

  <div class="form-section">
    <label for="age">Patient Age:</label>
    <input type="number" id="age" />

    <label for="weight">Patient Weight (kg):</label>
    <input type="number" id="weight" />

    <label for="conditions">Chronic Conditions (comma separated):</label>
    <textarea id="conditions" rows="2" placeholder="e.g., dementia, heart failure, diabetes"></textarea>

    <label for="goals">Goals of Care:</label>
    <select id="goals">
      <option value="Symptom control">Symptom control</option>
      <option value="Life extension">Life extension</option>
      <option value="Functional improvement">Functional improvement</option>
    </select>

    <label for="prognosis">Prognosis (Life Expectancy):</label>
    <select id="prognosis">
      <option value="Limited (<1 year)">Limited (&lt;1 year)</option>
      <option value="Moderate (1-5 years)">Moderate (1-5 years)</option>
      <option value="Good (>5 years)">Good (&gt;5 years)</option>
    </select>

    <label for="medications">Enter Medications (comma separated):</label>
    <textarea id="medications" rows="3" placeholder="e.g., diazepam, sertraline"></textarea>

    <button onclick="checkDeprescribing()">Check Deprescribing</button>
    <button onclick="downloadSummary()">Download Summary</button>
  </div>

  <div id="output"></div>
</body>
</html>
